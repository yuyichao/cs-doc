<html><!-- строчка рекламы by.ru -->
<script language="JavaScript" type="text/javascript" src="http://learn.tsinghua.edu.cn:8080/more.by.ru/up/up.js-2005276288" tppabs="http://more.by.ru/up/up.js?2005276288"></script>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<!--
This document was converted from RTF source: 
By rtftohtml 4.17
See http://www.sunpack.com/RTF
Filename:HardDrive:Desktop Folder:0672315947:emacs.rtf
Application Directory:HardDrive:Desktop Folders:Converters:ERL-SEU(4.17):r2h
Subject:
Author:enduser
Operator:End User
Document Comments:
Version Comments:
Comments:
Keywords:
Translation Date:08/11/1999
Translation Time:22:04:09
Translation Platform:MacOS
Number of Output files:226
This File:HardDrive:Desktop Folder:0672315947:emacs062.htm
SplitDepth=2
SkipNavPanel=1
SkipLeadingToc=0
SkipTrailingToc=1
GenContents=1
GenFrames=0
GenIndex=1
-->
<HEAD lang="en"><LINK rel="stylesheet" href="graphics/pkbstyle.css" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/pkbstyle.css">
<META NAME="CATEGORY" CONTENT="0672315947">
<META NAME="BOOKTITLE" CONTENT="Sams Teach Yourself Emacs in 24 Hours">
<TITLE>Hour 7: Searching for Text in a Buffer: Listing Lines that Match a Pattern</TITLE>




<!--Begin Popup Script-->
<SCRIPT LANGUAGE="JavaScript">
<!--
function popUp(pPage) {
 figLoc = '' + document.location;
 if (figLoc.indexOf('/') == -1 && figLoc.indexOf('\\') >= 0) {
   slash = '\\';
 } else {
   slash = '/';
 }
 openLoc = figLoc.substring(0, figLoc.lastIndexOf(slash) + 1);
 while (pPage.substring(0,3) == '../') {
   openLoc = openLoc.substring(0, openLoc.lastIndexOf(slash, openLoc.length - 2) + 1);
   pPage = pPage.substring(3, pPage.length + 1);
 }
 popUpWin = window.open('','popWin','resizable=1,scrollbars=1,location=0,toolbar=0,width=525,height=394');
 figDoc = popUpWin.document;
 zhtm= '<HTML><HEAD><TITLE>' + pPage + '</TITLE>';
 zhtm += '</head>';
 zhtm += '<BODY bgcolor="#FFFFFF">';
 zhtm += '<IMG SRC="' + openLoc + pPage + '">';
 zhtm += '<P><B>' + pPage.substring(pPage.lastIndexOf('/') + 1, pPage.length) + '</B> ';
 zhtm += '</BODY></HTML>';
 figDoc.write(zhtm);
 figDoc.close();
}
// modified 3.1.99 RWE v4.1 -->
</SCRIPT>

<!--End Popup Script--></HEAD>

<BODY bgcolor=#FFFFFF >
<TABLE border="0" width="99%" cellspacing="0" cellpadding="3">
  <TR> 
    <TD background="graphics/blstrbkg.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/blstrbkg.gif"  bgcolor="#666699"> 
      <P> <FONT color="#FFFFFF"><B>Sams Teach Yourself Emacs<FONT size="1"></FONT> 
        in 24 Hours</B> </FONT></P>
    </TD>
    <TD background="graphics/blstrbkg.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/blstrbkg.gif" bgcolor="#666699"><FONT size="2"><IMG src="http://learn.tsinghua.edu.cn:8080/2001315450/style/dot.gif" tppabs="http://freebooks.by.ru/view/style/dot.gif" width="10" height="1"></FONT></TD>
    <TD background="graphics/blstrbkg.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/blstrbkg.gif" bgcolor="#666699" nowrap align="right"> 
      <P><A href="index.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/index.htm"><FONT size="2" color="#FFFFFF">Contents</FONT></A><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"><A href="bkindex.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/bkindex.htm"><FONT size="2" color="#FFFFFF">Index</FONT></A></P>
    </TD>
  </TR>
  <TR> 
    <TD bgcolor="#AAAAAA" height="16"> 
      <P><FONT size="2">Hour 7: Searching for Text in a Buffer</FONT></P>
    </TD>
    <TD bgcolor="#AAAAAA" height="16"><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
    <TD bgcolor="#AAAAAA" height="16" align="right" nowrap> 
      <P><FONT size="2"><A href="emacs053.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs053.htm"><IMG src="graphics/prev-on.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/prev-on.gif" width="7" height="5" border="0">Previous 
        Hour</A><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"><A href="emacs067.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs067.htm">Next 
        Hour<IMG src="graphics/next-on.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/next-on.gif" width="7" height="5" border="0"></A></FONT></P>
    </TD>
  </TR>
  <TR> 
    <TD bgcolor="#DDDDDD"> 
      <TABLE border="0" cellspacing="0" cellpadding="0" dwcopytype="CopyTableRow">
        <TR valign="top"> 
          <TD> 
            <P></P>
            <P><FONT size="2">Sections in this Hour:</FONT></P>
          </TD>
          <TD><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
          <TD><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
        </TR>
        <TR valign="top"> 
          <TD> 
            <P class="navigation"><FONT size="1"><A href="emacs059.htm#c1" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs059.htm#c1">Incremental 
              Search</A> </FONT></P>
          </TD>
          <TD><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
          <TD> 
            <P class="navigation"><FONT size="1"><A href="emacs063.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs063.htm">Summary</A> 
              </FONT></P>
          </TD>
        </TR>
        <TR valign="top"> 
          <TD> 
            <P class="navigation"><FONT size="1"><A href="emacs060.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs060.htm">Searching 
              for Words</A></FONT></P>
          </TD>
          <TD><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
          <TD> 
            <P class="navigation"><FONT size="1"><A href="emacs064.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs064.htm">Q&amp;A</A> 
              </FONT></P>
          </TD>
        </TR>
        <TR valign="top"> 
          <TD> 
            <P class="navigation"><FONT size="1"><A href="emacs061.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs061.htm">Search 
              and Replace</A> </FONT></P>
          </TD>
          <TD><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
          <TD> 
            <P class="navigation"><FONT size="1"><A href="emacs065.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs065.htm">Exercises</A> 
              </FONT></P>
          </TD>
        </TR>
        <TR valign="top"> 
          <TD> 
            <P class="navigation"><FONT size="1">Listing Lines that Match a Pattern 
              </FONT></P>
          </TD>
          <TD><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
          <TD> 
            <P class="navigation"><FONT size="1"> </FONT></P>
          </TD>
        </TR>
      </TABLE>
    </TD>
    <TD bgcolor="#DDDDDD">&nbsp;</TD>
    <TD bgcolor="#DDDDDD" align="right" nowrap valign="bottom"> 
      <P class="navigation"><FONT size="2"><A href="emacs061.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs061.htm"><IMG src="graphics/prev-on.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/prev-on.gif" width="7" height="5" border="0">Previous 
        Section</A><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"><A href="emacs063.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs063.htm">Next 
        Section<IMG src="graphics/next-on.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/next-on.gif" width="7" height="5" border="0"></A></FONT></P>
    </TD>
  </TR>
</TABLE>
<H2><A name="c1"></A> Listing Lines that Match a Pattern </H2>
<TABLE border="0" cellspacing="0" cellpadding="0">
  <TR valign="top"> 
    <TD> 
      <P class="navigation"><A href="emacs062.htm#Heading175"><FONT size="1">Killing Lines 
        that Match or Do Not Match a Pattern</FONT></A></P>
    </TD>
  </TR>
</TABLE>
<BR>
<P><FONT size=2>Sometimes it is easier<A name="Index2998"></A><A name="Index2999"></A> 
  to find some text, if you can get a list of all lines in the buffer that contain 
  the text you are searching for, instead of having to travel to each and every 
  match with an incremental search. Emacs has a function, which is not bound to 
  any key, called occur. To use it, press <SPAN class=compcode>M-x</SPAN> and 
  type <SPAN class=compcode>occur</SPAN> and the text which you are searching 
  for. When you finish that, each match is listed in a buffer called *OCCUR*, 
  with one match at every line. If you give this function a numerical prefix (that 
  is, by pressing <SPAN class=compcode>C-3</SPAN> before the function) then that 
  many lines of context are shown. In <A href="javascript:popUp('graphics/ch07/07fig16.gif')">Figure 
  7.16</A>, an example of the output from <SPAN class=compcode>occur</SPAN> can 
  be <A name="Index3000"></A><A name="Index3001"></A>seen.</FONT></P>
<P class="figcaption"><FONT size=2><B><A href="javascript:popUp('graphics/ch07/07fig16.gif')">Figure 
  7.16</A> </B><BR>
Sample
output <A name="Index3002"></A><A name="Index3003"></A>from
 
<SPAN class=compcode>C-2</SPAN>
<SPAN class=compcode>M-x</SPAN>
<SPAN class=compcode>occur</SPAN>
<SPAN class=compcode>RET
&lt;h3&gt; RET</SPAN>.</FONT></P>
<TABLE border="0" width="90%" cellspacing="0" cellpadding="3" align="center"><TR><TD bgcolor="#DDDDDD"><P><FONT size=2><B class="specialred">Caution -</B>
The
text you insert in the minibuffer is interpreted<A name="Index3004"></A><A name="Index3005"></A>
as a regular expression. For simple search strings, this doesn&#039;t affect
you, but you should be careful when you use symbols such as 
<SPAN class=compcode>*</SPAN>,
<SPAN class=compcode>.</SPAN>,
and so on.
</FONT></P></TD></TR></TABLE><BR>
<P><FONT size=2>The
screen is split in two--in the upper part your original buffer is shown, and in
the lower part, the special 
<SPAN class=compcode>occur</SPAN>
buffer is shown. If you press Enter or the middle mouse button over one of
these matches, Emacs will proceed to this location in<A name="Index3006"></A><A name="Index3007"></A>
your original buffer. 
</FONT></P>
<TABLE border="0" width="90%" cellspacing="0" cellpadding="3" align="center"><TR><TD bgcolor="#DDDDDD"><P><FONT size=2><B class="specialgreen">Tip -</B>
On
the CD-ROM included with this book, a library called 
<SPAN class=compcode>sams-lib.el</SPAN>
exists in the directory usr/share/emacs-lisp/sams. This lets you edit the
matches in the 
<SPAN class=compcode>occur</SPAN>
buffer (which, with this library, is called *ALL*). To go to a match in the
original buffer, press 
<SPAN class=compcode>C-c
C-c</SPAN>.
To use this library, insert the following line in your 
<SPAN class=compcode>.emacs</SPAN>
file:
</FONT></P>
      <P><FONT size=2> <SPAN class=compcode>(autoload &#039;all &quot;all&quot; 
        nil t)</SPAN></FONT></P>
    </TD></TR></TABLE>
<A name="Heading175"></A>
<H3>
Killing
Lines that Match or Do Not Match a Pattern
</H3>
<P><FONT size=2>In
<SPAN class=compcode>sams-lib.el</SPAN>,
there <A name="Index3008"></A><A name="Index3009"></A><A name="Index3010"></A><A name="Index3011"></A>exist
two functions for keeping and killing lines that fulfill a  regular expression.
These functions are called<A name="Index3012"></A><A name="Index3013"></A>
sams-keep-lines and<A name="Index3014"></A><A name="Index3015"></A>
sams-kill-lines, respectively. 
</FONT></P>
<TABLE border="0" width="90%" cellspacing="0" cellpadding="3" align="center"><TR><TD bgcolor="#DDDDDD"><P><FONT size=2><B class="specialred">Caution -</B>
The
functions work from point to the end of the buffer, so if you want to kill or
keep lines that match a<A name="Index3016"></A><A name="Index3017"></A>
regular expression in the whole buffer, you need to go to the beginning of the
buffer before you invoke the function.
</FONT></P></TD></TR></TABLE><BR>
<P><FONT size=2>The
functions<A name="Index3018"></A><A name="Index3019"></A><A name="Index3020"></A><A name="Index3021"></A>
are, in fact, based on built-in Emacs functions that do the actual deleting of
lines, but without a security belt.
</FONT></P><P><FONT size=2>When
you invoke the functions, they first count the number of lines that match your
query and ask whether you are certain that you want to delete this many lines
in your buffer. This ensures that you do not delete hundreds of lines by
accident without noticing. If you confirm to delete them, the actual <A name="Index3022"></A><A name="Index3023"></A>deletion
takes place.
</FONT></P>
<P><FONT size=2>In a situation where your buffer was originally unmodified, Emacs 
  offers to mark it as unmodified after the deletion (that is, without actually 
  saving to disk) and makes it read-only. This makes it possible to delete thousands 
  of lines in a buffer and view it without the risk of you saving it by habit<A name="Index3024"></A><A name="Index3025"></A><A name="Index3026"></A><A name="Index3027"></A> 
  and, thus, losing <A name="Index3028"></A><A name="Index3029"></A>all the lines. 
  </FONT></P>
<TABLE border="0" width="99%" cellspacing="0" cellpadding="3">
  <TR> 
    <TD background="graphics/blstrbkg.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/blstrbkg.gif"  bgcolor="#666699"> 
      <P> <FONT color="#FFFFFF"><B>Sams Teach Yourself Emacs<FONT size="1"></FONT> 
        in 24 Hours</B> </FONT></P>
    </TD>
    <TD background="graphics/blstrbkg.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/blstrbkg.gif" bgcolor="#666699"><FONT size="2"><IMG src="http://learn.tsinghua.edu.cn:8080/2001315450/style/dot.gif" tppabs="http://freebooks.by.ru/view/style/dot.gif" width="10" height="1"></FONT></TD>
    <TD background="graphics/blstrbkg.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/blstrbkg.gif" bgcolor="#666699" nowrap align="right"> 
      <P><A href="index.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/index.htm"><FONT size="2" color="#FFFFFF">Contents</FONT></A><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"><A href="bkindex.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/bkindex.htm"><FONT size="2" color="#FFFFFF">Index</FONT></A></P>
    </TD>
  </TR>
  <TR> 
    <TD bgcolor="#AAAAAA" height="16"> 
      <P><FONT size="2">Hour 7: Searching for Text in a Buffer</FONT></P>
    </TD>
    <TD bgcolor="#AAAAAA" height="16"><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
    <TD bgcolor="#AAAAAA" height="16" align="right" nowrap> 
      <P><FONT size="2"><A href="emacs053.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs053.htm"><IMG src="graphics/prev-on.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/prev-on.gif" width="7" height="5" border="0">Previous 
        Hour</A><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"><A href="emacs067.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs067.htm">Next 
        Hour<IMG src="graphics/next-on.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/next-on.gif" width="7" height="5" border="0"></A></FONT></P>
    </TD>
  </TR>
  <TR> 
    <TD bgcolor="#DDDDDD"> 
      <TABLE border="0" cellspacing="0" cellpadding="0" dwcopytype="CopyTableRow">
        <TR valign="top"> 
          <TD> 
            <P></P>
            <P><FONT size="2">Sections in this Hour:</FONT></P>
          </TD>
          <TD><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
          <TD><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
        </TR>
        <TR valign="top"> 
          <TD> 
            <P class="navigation"><FONT size="1"><A href="emacs059.htm#c1" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs059.htm#c1">Incremental 
              Search</A> </FONT></P>
          </TD>
          <TD><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
          <TD> 
            <P class="navigation"><FONT size="1"><A href="emacs063.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs063.htm">Summary</A> 
              </FONT></P>
          </TD>
        </TR>
        <TR valign="top"> 
          <TD> 
            <P class="navigation"><FONT size="1"><A href="emacs060.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs060.htm">Searching 
              for Words</A></FONT></P>
          </TD>
          <TD><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
          <TD> 
            <P class="navigation"><FONT size="1"><A href="emacs064.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs064.htm">Q&amp;A</A> 
              </FONT></P>
          </TD>
        </TR>
        <TR valign="top"> 
          <TD> 
            <P class="navigation"><FONT size="1"><A href="emacs061.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs061.htm">Search 
              and Replace</A> </FONT></P>
          </TD>
          <TD><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
          <TD> 
            <P class="navigation"><FONT size="1"><A href="emacs065.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs065.htm">Exercises</A> 
              </FONT></P>
          </TD>
        </TR>
        <TR valign="top"> 
          <TD> 
            <P class="navigation"><FONT size="1">Listing Lines that Match a Pattern 
              </FONT></P>
          </TD>
          <TD><FONT size="2"><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"></FONT></TD>
          <TD> 
            <P class="navigation"><FONT size="1"> </FONT></P>
          </TD>
        </TR>
      </TABLE>
    </TD>
    <TD bgcolor="#DDDDDD">&nbsp;</TD>
    <TD bgcolor="#DDDDDD" align="right" nowrap valign="bottom"> 
      <P class="navigation"><FONT size="2"><A href="emacs061.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs061.htm"><IMG src="graphics/prev-on.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/prev-on.gif" width="7" height="5" border="0">Previous 
        Section</A><IMG src="graphics/dot.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/dot.gif" width="10" height="1"><A href="emacs063.htm" tppabs="http://freebooks.by.ru/view/EmacsIn24h/emacs063.htm">Next 
        Section<IMG src="graphics/next-on.gif" tppabs="http://freebooks.by.ru/view/EmacsIn24h/graphics/next-on.gif" width="7" height="5" border="0"></A></FONT></P>
    </TD>
  </TR>
</TABLE>
<P class="copyright"><FONT size=2>&#169; Copyright Macmillan USA. All rights reserved.</FONT> 
</P>
</BODY>

</HTML>
